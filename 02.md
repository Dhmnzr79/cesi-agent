Вариант 1: Header Extractor (Custom Function)
Это программный метод. Мы не меняем базу данных, а заставляем бота «читать оглавление» прямо в момент формирования ответа.

Как это выглядит на холсте Flowise:

Retriever Node: Находит релевантные куски текста (чанки).

Custom Function Node (JS): Стоит сразу после ретривера. Она получает массив данных и «выкусывает» из него все строки, начинающиеся на ###.

Flow State Update: Извлеченные заголовки записываются в переменную {{ $flow.state.current_topics }}.

Chat Model: Получает финальный промпт, где в блоке 4.1 указан этот список.

Плюсы:

Автоматизация: Тебе не нужно вручную составлять списки тем, бот сам видит их в MD-файлах.

Гибкость: Если ты добавишь новый подраздел в файл, бот узнает о нем мгновенно без переиндексации.

Минусы:

Если ретривер из-за настроек Top-K (количество чанков) не достал кусок файла, где был заголовок, бот об этом заголовке не узнает.

Код для Cursor (вставить в Custom Function):

JavaScript
// Получаем документы от ретривера
const docs = Array.isArray($retrieverAgentflow_0) ? $retrieverAgentflow_0 : [];
let headers = [];

docs.forEach(doc => {
    // Регулярное выражение для поиска строк вида ### Заголовок
    const matches = doc.pageContent.match(/^###\s+(.*)/gm);
    if (matches) {
        matches.forEach(m => {
            // Очищаем от знаков # и лишних пробелов
            const clean = m.replace(/^###\s+/, '').trim();
            if (!headers.includes(clean)) headers.push(clean);
        });
    }
});

// Возвращаем строку через запятую для Flow State
return headers.join(', ');