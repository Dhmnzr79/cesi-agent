# Анализ папки info/ — замечания и вопросы

## 1. Взаимосвязь документов

**Сильные стороны:**
- `README.md` хорошо фиксирует, что является источником истины:
  - `bot.md`, `flowise.md`, `logic.md`, `cta.md`, `prompt.md`, `rules.md`, `roadmap.md`, `backlog.md`.
- `bot.md` чётко отделяет Flowise, backend, виджет и nginx (контракты API, CORS).
- `flowise.md` аккуратно завязывает AgentFlow V2 на:
  - `prompt.md` (промпт + схема ответа),
  - `cta.md` (CTA архитектура),
  - `logic.md` (поведение),
  - `backlog.md` (планы по изменениям).
- `cta.md` и `prompt.md` согласованы по идее:
  - P0: плоская JSON-схема,
  - P1+: полная вложенная модель `ui/meta/flags`.

**Вопрос к владельцу проекта:**  
- Останавливаться на P0 (плоские ключи) или двигаться к P1+ для этого бота? Сейчас документы описывают обе схемы, но фактическая реализация в Flowise и фронте — P0.

---

## 2. Возможные противоречия / места для уточнения

### 2.1. Пустой current_topics в `prompt.md`

- В §4.1:
  - «Если `current_topics` пустой или отсутствует — ответь коротко, что по этому запросу информации в базе нет…»
- В §7 (Обязательный вектор продолжения):
  - уже заложена более точная логика:
    - если есть контент, но `current_topics` пуст (адрес/контакты/общие reference) → нормальный ответ + общий вопрос.

**Рекомендация:**
- Явно развести два сценария:
  - а) нет контента,
  - б) есть контент, но нет подразделов.
- Чуть переписать §4.1 под фактически принятую логику из §7.

### 2.2. P0 vs P1+ (cta.md, idea.md, flowise.md)

- Сейчас:
  - `prompt.md` §14 + `flowise.md` §3.1 описывают **минимальную P0-схему** (плоские поля).
  - `cta.md` и `idea.md` подробно расписывают **P1+** (вложенные `ui`, `meta`, `flags`, доп. сигналы).
- Это не баг, но:
  - при переходе к P1+ важно:
    - синхронно обновить `prompt.md` (формат ответа),
    - `flowise.md` (настройка LLM-ноды),
    - и фронт (парсинг вложенной структуры).

**Вопрос:**  
- Планируется ли в этом проекте переходить на «богатую» P1+ схему, или P0 — финальный для этой версии?

---

## 3. Что может быть недосказано / стоит усилить

### 3.1. Явная документация по типам md-файлов

Сейчас это описано скорее в `idea.md` и в переписке (reference vs deep/compact). В `info` нет отдельного явного файла стандарта для md.

**Возможный недостающий документ:**
- `info/md-guidelines.md`:
  - правила: один файл = одна тема,
  - классификация: `reference`, `deep/compact`, `service`,
  - требования к `### Коротко` и заголовкам `###` (3–4 штуки, 3–7 слов, польза для пациента).

### 3.2. Memory Check формализован только текстом

- В `prompt.md` описано, что бот не должен предлагать уже раскрытые подразделы.
- Но нет явного описания:
  - как тестировать это поведение;
  - какие edge cases считать «уже раскрыто».

**Если усиливать:**
- Можно добавить в `prompt.md` небольшой подпункт с 2–3 примерами:
  - запрос → ответ с «рассказать про…» → следующий запрос «расскажи про…» → что дальше не предлагать.

---

## 4. idea.md — статус и использование

**Плюсы:**
- Очень хорошая «лаборатория идей» для:
  - semi-agent логики,
  - Lead Card на фронте,
  - расширенных медицинских флагов.

**Риски:**
- Идеи не всегда приведены к архитектурной фиксации в основных файлах.
- Если потом вернуться к файлу через время, часть мыслей может конфликтовать с реальной P0/P1 схемой.

**Рекомендация:**
- Оставить `idea.md` как есть, но:
  - всё, что реально внедряется, переносить кратко в:
    - `cta.md` (если это поля/CTA),
    - `logic.md` (если это поведение),
    - `flowise.md` (если это конкретная настройка AgentFlow V2).

---

## 5. Backlog/Roadmap vs фактическая стадия

- `roadmap.md` и `backlog.md` аккуратно делят P0 / P1 / P2.
- По описанию:
  - сейчас проект на этапе P0:
    - логика записи в диалоге,
    - базовый CTA,
    - RAG + current_topics.

**Вопрос для синхронизации:**
- Нужно ли зафиксировать в одном месте «фактический статус» P0:
  - какие части уже включены в Flowise/виджет,
  - какие ещё только описаны (например, handoff по `meta_shouldHandoff`).

---

## 6. Вопросы, которые можно ещё прояснить (но не обязательно сейчас)

1. **Рабочее время клиники:**  
   - в `logic.md`/`backlog.md` оно фигурирует концептуально, но полезно один раз жёстко зафиксировать интервал и дни (в одном месте).
2. **Связка `emotional` и UX на фронте:**  
   - в `cta.md` описано, что при `flags.emotional = true` не показывать кнопки;  
   - можно отдельно отметить, как фронт будет визуально подсвечивать «замедленный режим» (или оставить на усмотрение фронта).

