# Анализ md-базы — замечания и вопросы

## 1. Соответствие принятой схеме

**Плюсы:**
- Один файл = одна тема (один `##` заголовок или цельный блок).
- Для deep-файлов:
  - есть `### Коротко` с маркетинговым резюме,
  - 2–4 `###`-подраздела с пользой для пациента,
  - без диалоговых хвостов («если хотите, расскажу…»).
- Reference-файлы (врачи, куратор, общие преимущества, консультация, контакты) идут без лишних `###` — это ожидаемое поведение.

---

## 2. Поведение RAG + current_topics по разным типам файлов

### 2.1. Reference-файлы (без `###`, кроме, возможно, Коротко)

Примеры:  
`impl__overview.md`, `impl__types.md`, `impl__curator.md`, `doctor__*.md`, `clinic__advantages.md`, `clinic__consultation.md`, `clinic__contacts.md`, `faq__tooth_loss.md`, `faq__tooth_one_day.md`, `price__clinic.md`.

**Следствие:**
- Custom Function не найдёт дополнительных `###` → для запросов, попадающих только в такие файлы, `current_topics` будет пустым.
- Это нормально в рамках принятой логики:
  - бот даст ответ по содержанию;
  - завершит общим вопросом/предложением, без предложений «рассказать подробнее про X».

**Концептуальный вопрос:**  
- Нужно ли когда‑то добавить простые `###` к части этих файлов (например, «Когда нужна консультация» к `clinic__consultation.md`), чтобы иметь чуть больше управляемых веток для current_topics?

### 2.2. Deep-файлы — всё ок

Примеры:  
`impl__type_*`, `impl__bone_graft.md`, `impl__contraindications.md`, `impl__what_after.md`, `faq__*` по боли/приживаемости/стоимости, `clinic__technology.md`, `clinic__warranty.md`, все `service__*.md`.

**Наблюдение:**
- Количество `###` в пределах 2–4.
- Названия заголовков живые и пациент-ориентированные («Кому подходит», «Почему не больно», «Когда не подходит»), хорошо подходят для формулировки «могу рассказать про…».

---

## 3. Потенциальные дубли и технички

- В выводе `Glob` были дубли путей (`faq__pain.md`, `clinic__warranty.md`, `clinic__technology.md`, `impl__type_*`) из‑за смешения `/` и `\` в списке файлов.
- На структуру базы это не влияет, важно только, чтобы в реальном Document Store не было задвоенных загрузок одного и того же файла.

---

## 4. Баланс приоритетов: имплантация vs сервисные услуги

- Имплантация/протезирование:
  - много deep-файлов, хорошее покрытие: методы, боль, сроки, приживаемость, стоимость, кость, противопоказания, гарантии.
- `service__*`:
  - аккуратные, но по логике `logic.md` должны быть «короткими ветками»:
    - 1–2 хода диалога + handoff/перевод фокуса (при попытке уйти в длинную консультацию).

**Рекомендация по использованию:**
- Всё уже готово для такого поведения — вопрос только в промпте/тестировании, а не в структуре md.

---

## 5. Строгий взгляд: возможные микро-улучшения (необязательные)

1. **`clinic__technology.md` без явного `##`:**  
   - Сейчас файл начинается сразу с `### Коротко`.  
   - Для RAG это не критично, но с точки зрения единообразия можно позже добавить `## Цифровые технологии и лаборатория` над первым `###`.

2. **`impl__overview.md` и `impl__types.md` — только списки без `###`:**  
   - Они ближе к reference-резюме.  
   - Это ок, если цель — чтобы бот давал их как цельный блок, а не дробил на подтемы.

3. **`price__clinic.md` — только список без `###`:**  
   - Логически всё норм: это доп. блок про общие условия.  
   - Просто учитывать, что `current_topics` для запросов только по этому файлу будет пуст (см. механику в `current-topics-mechanics.md`).

---

## 6. Вывод

- База `md/` уже приведена к принятой схеме:
  - один файл = одна тема;
  - `### Коротко` + 2–4 пациент-ориентированных заголовка в deep-файлах;
  - reference-файлы без искусственных подразделов.
- Основные пограничные моменты (reference-only файлы, `clinic__technology.md` без `##`) не ломают логику RAG:
  - они лишь определяют, где бот:
    - даёт обобщённый ответ и завершает общим вопросом,
    - и где строит вектор продолжения по конкретным `current_topics`.

