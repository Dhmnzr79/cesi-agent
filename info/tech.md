# Текущее техническое состояние чат-бота

## Общая архитектура
Чат-бот реализован как сервис с разделением ответственности между логикой, интерфейсом и сайтами-клиентами.

Архитектура рассчитана «на вырост» и не использует встроенный UI Flowise.

---

## Инфраструктура

### VPS
- Используется VPS с IP: `166.1.221.146`
- На VPS установлены:
  - Docker
  - Flowise (AgentFlow V2)
  - nginx
- VPS выполняет роль серверной платформы бота

### Flowise
- Flowise используется **только как мозг бота**
- Flowise **не вызывает** backend, не использует HTTP-ноды для заявок. Только Prediction API (диалог).
- В Flowise реализованы:
  - логика диалога
  - системный промпт
  - RAG на базе markdown-файлов
- Доступ к Flowise осуществляется по HTTPS через nginx (reverse proxy)
- Встроенный Flowise-виджет **не используется**

---

## Домены и DNS

### DNS
- Домен `bot.jeeptour41.ru` указывает (A-record) на VPS `166.1.221.146`
- reg.ru используется **только как DNS-регистратор**, не как хостинг

### Роль домена
- `bot.jeeptour41.ru` — публичная точка доступа к:
  - API Flowise
  - статике виджета

---

## nginx

### Назначение
- nginx выполняет две роли:
  1. Reverse proxy для Flowise
  2. Сервер статики для виджета

### Разделение маршрутов
- `/api/...` → проксируется в Flowise (Prediction API и др.)
- `/widget/...` → отдаётся как статические файлы
- Backend (`/api/send-lead`) — отдельный сервис; виджет обращается к backend по своему URL (или через отдельный маршрут nginx)

### Статика виджета
Физическое расположение файлов:
/var/www/html/widget/
widget.js
widget.css

---

## Фронт бота (Widget)

### Общие принципы
- Используется собственный универсальный JS-виджет
- Виджет:
  - не содержит бизнес-логики
  - не знает тем и сценариев
  - работает как UI-исполнитель
- Один и тот же виджет используется для всех проектов

### Подключение на сайт
На любом сайте достаточно подключить:
<script src="https://bot.jeeptour41.ru/widget/widget.js"></script>