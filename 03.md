Вариант 2: Separate Outline Store (Архитектура «Шпаргалка»)
Это структурный метод. Мы создаем отдельный «индекс оглавлений», чтобы бот всегда видел всю карту темы целиком.

Как это выглядит на холсте Flowise:

Retriever 1 (Main): Ищет подробный контент для ответа.

Retriever 2 (Outlines): Ищет в специальной папке файл с таким же названием, но содержащий только список всех ### заголовков этого документа.

Flow State Update: Весь текст из «файла-шпаргалки» целиком записывается в {{ $flow.state.current_topics }}.

Плюсы:

100% надежность: Бот всегда видит полный список подразделов файла, даже если основной ретривер достал всего одну строчку текста.

Контроль: Ты можешь вручную скрыть какие-то подразделы от предложений бота, просто не вписывая их в файл-шпаргалку.

Минусы:

Двойная работа: Тебе нужно поддерживать два набора файлов: основной контент и сокращенные «карты тем».

Пример структуры файла-шпаргалки (impl_classic_outline.md):

Этапы, Цена, Противопоказания, Гарантии, Сроки